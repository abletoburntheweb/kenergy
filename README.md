---

# Инструкция по развертке проекта

Эта инструкция поможет вам развернуть проект с GitHub, создать виртуальное окружение, установить зависимости, настроить базу данных и запустить сервер разработки Django.

## Клонирование репозитория
Перед началом работы склонируйте репозиторий с проектом в нужную вам папку:
```bash
git clone https://github.com/abletoburntheweb/kenergy.git
```

## Запуск проекта
Откройте терминал (например, CMD, PowerShell или VSCode Terminal) и перейдите в папку с проектом:
```bash
cd ...\kenergy\
```

### Создание виртуального окружения
Виртуальное окружение — это изолированная среда, в которой хранятся зависимости Python-проекта. Это нужно, чтобы не засорять глобальную систему и избежать конфликтов между проектами. Для создания виртуального окружения выполните:
```bash
python -m venv venv
```

### Активация виртуального пространства
Для активации виртуального окружения выполните:
```bash
.\venv\Scripts\activate
```
После активации строка командной строки изменится — появится префикс `(venv)`:
```bash
(venv) C:\...\kenergy\>
```

#### Ошибка: `cannot be loaded because running scripts is disabled on this system`
Если вы видите ошибку вроде:
```
File C:\...\venv\Scripts\Activate.ps1 cannot be loaded because running scripts is disabled on this system.
```
Это означает, что PowerShell запрещает выполнение скриптов. Чтобы разрешить выполнение скриптов для текущего пользователя, выполните:
```bash
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```
Если нужно вернуть все обратно:
```bash
Set-ExecutionPolicy -ExecutionPolicy Restricted -Scope CurrentUser
```

### Установка зависимостей
Установите зависимости из файла `requirements.txt`:
```bash
pip install -r requirements.txt
```
Это установит все необходимые библиотеки (например, Django, psycopg2 и другие).

### Выполнение миграций
Проект использует базу данных. Если вы еще не подключили БД, перейдите к разделу **Как подключить базу данных**. После этого выполните миграции:
```bash
python manage.py makemigrations
python manage.py migrate
```
Это создаст или обновит таблицы в базе данных согласно вашим моделям.

### Создание суперпользователя
Создайте суперпользователя для доступа к административной панели Django:
```bash
python manage.py createsuperuser
```
Следуйте инструкциям в терминале, чтобы задать имя пользователя, почту и пароль.

### Запуск сервера разработки Django
Запустите сервер разработки:
```bash
python manage.py runserver
```
Вывод в терминале будет примерно такой:
```
Watching for file changes with StatReloader
Performing system checks...

Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
```
Откройте проект в браузере:
```
http://127.0.0.1:8000/
```

---

## FAQ

### Как создать обычного пользователя?
Чтобы создать обычного пользователя (не суперпользователя), воспользуйтесь командной оболочкой Django:
```bash
python manage.py shell
```
Затем выполните следующий код:
```python
from django.contrib.auth.models import User

user = User.objects.create_user(
    username='ваше_имя_пользователя',
    password='ваш_пароль',
    email='почта@пример.ком'  # Можно оставить пустым
)
```
Чтобы проверить, что пользователь создан, выполните:
```python
User.objects.all()
```

---

## Как подключить базу данных

### Настройка подключения к базе данных
По умолчанию проект настроен на работу с PostgreSQL. Параметры подключения находятся в файле `kenergy/settings.py`:
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'имя_бд',
        'USER': 'имя_пользователя',
        'PASSWORD': 'пароль_пользователя',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

### Создание БД с нуля
Если у вас еще нет базы данных, выполните следующие шаги:

#### Через SQL Shell (psql)
1. Откройте SQL Shell (psql).
2. Введите параметры подключения:
   ```
   Server [localhost]:
   Database [postgres]:
   Port [5432]:
   Username [postgres]:
   Password: ****
   ```
3. Создайте новую базу данных:
   ```sql
   CREATE DATABASE new_database;
   ```
4. Создайте нового пользователя с паролем:
   ```sql
   CREATE USER admin WITH PASSWORD '12345';
   ```
5. Дайте пользователю все права на базу:
   ```sql
   GRANT ALL PRIVILEGES ON DATABASE new_database TO admin;
   ```

#### Через pgAdmin4
1. Откройте pgAdmin.
2. Создайте новую базу данных:
   - В левой панели правый клик по **База данных** → **Создать** → **База данных...**
   - В поле «База данных» введите `new_database` или любое другое имя.
3. Создайте нового пользователя:
   - В дереве слева откройте **Роли входа/группы** → ПКМ → **Создать** → **Роль входа**.
   - Укажите имя пользователя, пароль и разрешите вход.
4. Назначьте права:
   - Найдите базу данных → ПКМ → **Мастер назначения прав** → Выберите роль и назначьте все права.

---

## Решение проблем

Если проект не запускается, проверьте:
1. Установлена ли правильная версия Python (3.8 или выше):
   ```bash
   python --version
   ```
2. Активировано ли виртуальное окружение (должен быть префикс `(venv)` в консоли).
3. Установлены ли зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Верно ли указаны параметры подключения в `settings.py` → `DATABASES`.
5. Если ошибка: `can't open file "C:\...\manage.py": [Errno 2] No such file or directory`, убедитесь, что вы перешли в директорию проекта:
   ```bash
   cd ...\kenergy\
   ```

---
